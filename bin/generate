#! /usr/bin/env ruby

require 'fileutils'
require 'json'
require_relative '../lib/dsn'

base_url = ENV['BASE_URL'] || raise('BASE_URL not set')

puts 'Fetching DSN data...'
output = DSN.fetch(base_url: base_url)

puts 'Recreating _build directory...'
FileUtils.rm_rf('_build')
Dir.mkdir('_build')

puts 'Copying images...'
FileUtils.cp_r('public/images', '_build/images')

puts 'Writing _build/dsn.json...'
File.open('_build/dsn.json', 'w') do |file|
  file.write(output.to_json)
end

puts 'Done!'
